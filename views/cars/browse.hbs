<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} - AutoRentPro</title>
    <link rel="stylesheet" href="/css/browse.css">
</head>

<body>
    {{> navbar}}

    <div class="browse-container">
        <!-- HERO SEARCH SECTION -->
        <section class="hero-search">
            <div class="hero-content">
                <h1>üöó T√¨m xe ho√†n h·∫£o cho chuy·∫øn ƒëi</h1>
                <p>H∆°n 1000+ xe ch·∫•t l∆∞·ª£ng cao s·∫µn s√†ng ph·ª•c v·ª•</p>

                <form class="quick-search" id="quickSearchForm">
                    <div class="search-row">
                        <div class="search-field">
                            <label>üìç ƒê·ªãa ƒëi·ªÉm</label>
                            <input type="text" name="city" placeholder="Th√†nh ph·ªë..." value="{{filters.city}}">
                        </div>
                        <div class="search-field">
                            <label>üìÖ Nh·∫≠n xe</label>
                            <input type="date" name="startDate" value="{{filters.startDate}}" required>
                        </div>
                        <div class="search-field">
                            <label>üìÖ Tr·∫£ xe</label>
                            <input type="date" name="endDate" value="{{filters.endDate}}" required>
                        </div>
                        <button type="submit" class="btn-search">T√¨m ki·∫øm</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- FILTERS & RESULTS -->
        <section class="main-content">
            <aside class="filters-sidebar">
                <div class="filter-header">
                    <h3>üîç B·ªô l·ªçc</h3>
                    <button class="btn-reset" onclick="resetFilters()">ƒê·∫∑t l·∫°i</button>
                </div>

                <form id="filterForm">
                    <!-- CATEGORY FILTER -->
                    <div class="filter-group">
                        <h4>Lo·∫°i xe</h4>
                        <label class="filter-option">
                            <input type="radio" name="category" value="" {{#unless filters.category}}checked{{/unless}}>
                            <span>T·∫•t c·∫£</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="category" value="ECONOMY" {{#if (eq filters.category 'ECONOMY'
                                )}}checked{{/if}}>
                            <span>üöô Ti·∫øt ki·ªám</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="category" value="COMFORT" {{#if (eq filters.category 'COMFORT'
                                )}}checked{{/if}}>
                            <span>üöó Tho·∫£i m√°i</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="category" value="PREMIUM" {{#if (eq filters.category 'PREMIUM'
                                )}}checked{{/if}}>
                            <span>‚ú® Cao c·∫•p</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="category" value="SUV" {{#if (eq filters.category 'SUV'
                                )}}checked{{/if}}>
                            <span>üöô SUV</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="category" value="VAN" {{#if (eq filters.category 'VAN'
                                )}}checked{{/if}}>
                            <span>üöê Van</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="category" value="LUXURY" {{#if (eq filters.category 'LUXURY'
                                )}}checked{{/if}}>
                            <span>üíé Sang tr·ªçng</span>
                        </label>
                    </div>

                    <!-- PRICE RANGE -->
                    <div class="filter-group">
                        <h4>Gi√° thu√™/ng√†y</h4>
                        <div class="price-inputs">
                            <input type="number" name="minPrice" placeholder="T·ª´" value="{{filters.minPrice}}">
                            <span>-</span>
                            <input type="number" name="maxPrice" placeholder="ƒê·∫øn" value="{{filters.maxPrice}}">
                        </div>
                    </div>

                    <!-- TRANSMISSION -->
                    <div class="filter-group">
                        <h4>H·ªôp s·ªë</h4>
                        <label class="filter-option">
                            <input type="checkbox" name="transmission" value="AUTOMATIC" {{#if (includes
                                filters.transmission 'AUTOMATIC' )}}checked{{/if}}>
                            <span>T·ª± ƒë·ªông</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="transmission" value="MANUAL" {{#if (includes
                                filters.transmission 'MANUAL' )}}checked{{/if}}>
                            <span>S·ªë s√†n</span>
                        </label>
                    </div>

                    <!-- FUEL TYPE -->
                    <div class="filter-group">
                        <h4>Nhi√™n li·ªáu</h4>
                        <label class="filter-option">
                            <input type="checkbox" name="fuelType" value="PETROL" {{#if (includes
                                filters.fuelType 'PETROL' )}}checked{{/if}}>
                            <span>‚õΩ XƒÉng</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="fuelType" value="DIESEL" {{#if (includes
                                filters.fuelType 'DIESEL' )}}checked{{/if}}>
                            <span>üõ¢Ô∏è D·∫ßu</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="fuelType" value="ELECTRIC" {{#if (includes
                                filters.fuelType 'ELECTRIC' )}}checked{{/if}}>
                            <span>‚ö° ƒêi·ªán</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="fuelType" value="HYBRID" {{#if (includes
                                filters.fuelType 'HYBRID' )}}checked{{/if}}>
                            <span>üîã Hybrid</span>
                        </label>
                    </div>

                    <!-- SEATS -->
                    <div class="filter-group">
                        <h4>S·ªë ch·ªó ng·ªìi</h4>
                        <select name="minSeats">
                            <option value="">T·ªëi thi·ªÉu</option>
                            <option value="2" {{#if (eq filters.minSeats '2' )}}selected{{/if}}>2+</option>
                            <option value="4" {{#if (eq filters.minSeats '4' )}}selected{{/if}}>4+</option>
                            <option value="5" {{#if (eq filters.minSeats '5' )}}selected{{/if}}>5+</option>
                            <option value="7" {{#if (eq filters.minSeats '7' )}}selected{{/if}}>7+</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-apply-filters">√Åp d·ª•ng b·ªô l·ªçc</button>
                </form>
            </aside>

            <main class="results-area">
                <!-- TOOLBAR -->
                <div class="results-toolbar">
                    <div class="results-info">
                        <h2>{{pagination.totalCars}} xe kh·∫£ d·ª•ng</h2>
                    </div>
                    <div class="view-controls">
                        <select name="sortBy" id="sortSelect" onchange="applySort(this.value)">
                            <option value="pricePerDay" {{#if (eq filters.sortBy 'pricePerDay' )}}selected{{/if}}>Gi√°
                                th·∫•p nh·∫•t</option>
                            <option value="-pricePerDay" {{#if (eq filters.sortBy '-pricePerDay' )}}selected{{/if}}>Gi√°
                                cao nh·∫•t</option>
                            <option value="-averageRating" {{#if (eq filters.sortBy '-averageRating' )}}selected{{/if}}>
                                ƒê√°nh gi√° cao</option>
                            <option value="-totalReviews" {{#if (eq filters.sortBy '-totalReviews' )}}selected{{/if}}>
                                Ph·ªï bi·∫øn</option>
                        </select>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid" onclick="toggleView('grid')">
                                <span>‚äû</span>
                            </button>
                            <button class="view-btn" data-view="list" onclick="toggleView('list')">
                                <span>‚ò∞</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CAR GRID -->
                <div class="cars-grid" id="carsGrid">
                    {{#if cars.length}}
                    {{#each cars}}
                    <div class="car-card">
                        <div class="car-image">
                            {{#if images.[0]}}
                            <img src="{{images.[0]}}" alt="{{brand}} {{model}}">
                            {{else}}
                            <div class="no-image">üì∑ Ch∆∞a c√≥ ·∫£nh</div>
                            {{/if}}
                            {{#if (gte averageRating 4.5)}}
                            <span class="badge-premium">‚≠ê Top rated</span>
                            {{/if}}
                        </div>
                        <div class="car-info">
                            <div class="car-header">
                                <h3>{{brand}} {{model}}</h3>
                                <span class="car-year">{{year}}</span>
                            </div>
                            <div class="car-specs">
                                <span class="spec">üë• {{seats}} ch·ªó</span>
                                <span class="spec">‚öôÔ∏è {{transmission}}</span>
                                <span class="spec">‚õΩ {{fuelType}}</span>
                            </div>
                            <div class="car-location">
                                üìç {{location.city}}{{#if location.district}}, {{location.district}}{{/if}}
                            </div>
                            {{#if averageRating}}
                            <div class="car-rating">
                                <span class="stars">‚≠ê {{averageRating}}</span>
                                <span class="reviews">({{totalReviews}} ƒë√°nh gi√°)</span>
                            </div>
                            {{/if}}
                            <div class="car-footer">
                                <div class="car-price">
                                    <span class="price-amount">{{formatPrice pricePerDay}}‚Ç´</span>
                                    <span class="price-unit">/ng√†y</span>
                                </div>
                                <a href="/cars/{{_id}}" class="btn-view-detail">Xem chi ti·∫øt ‚Üí</a>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                    {{else}}
                    <div class="no-results">
                        <h3>üòî Kh√¥ng t√¨m th·∫•y xe ph√π h·ª£p</h3>
                        <p>Th·ª≠ ƒëi·ªÅu ch·ªânh b·ªô l·ªçc ho·∫∑c t√¨m ki·∫øm kh√°c</p>
                        <button onclick="resetFilters()" class="btn-reset-large">ƒê·∫∑t l·∫°i b·ªô l·ªçc</button>
                    </div>
                    {{/if}}
                </div>

                <!-- PAGINATION -->
                {{#if (gt pagination.totalPages 1)}}
                <div class="pagination">
                    {{#if pagination.hasPrevPage}}
                    <a href="?page={{subtract pagination.currentPage 1}}" class="page-btn">‚Üê Tr∆∞·ªõc</a>
                    {{/if}}

                    <span class="page-info">Trang {{pagination.currentPage}} / {{pagination.totalPages}}</span>

                    {{#if pagination.hasNextPage}}
                    <a href="?page={{add pagination.currentPage 1}}" class="page-btn">Sau ‚Üí</a>
                    {{/if}}
                </div>
                {{/if}}
            </main>
        </section>
    </div>

    <script src="/js/browse.js"></script>
</body>

</html>