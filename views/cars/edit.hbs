<div class="row justify-content-center">
    <div class="col-lg-10 col-md-11">

        {{#if error}}
        <div class="alert alert-danger alert-dismissible fade show mb-4 shadow-sm border-0 rounded-3" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> <strong>L·ªói:</strong> {{error}}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {{/if}}

        <div class="card shadow-sm border-0 rounded-4">
            <div class="card-header bg-white text-center py-4 border-bottom">
                <h4 class="mb-1 fw-bold text-warning"><i class="bi bi-pencil-square me-2"></i>Ch·ªânh S·ª≠a Xe</h4>
                <p class="text-secondary small mb-0">C·∫≠p nh·∫≠t th√¥ng tin chi ti·∫øt v·ªÅ ph∆∞∆°ng ti·ªán</p>
            </div>
            <div class="card-body p-4 p-md-5">
                <form action="/cars/update/{{car._id}}" method="POST">

                    {{!-- SECTION 1: Basic Info --}}
                    <h6 class="text-muted fw-bold text-uppercase mb-3"><i class="bi bi-info-circle me-2"></i>Th√¥ng tin
                        c∆° b·∫£n</h6>

                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-secondary">H√£ng xe *</label>
                            <input type="text" name="brand" class="form-control bg-light border-0" value="{{car.brand}}"
                                required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-secondary">M·∫´u xe *</label>
                            <input type="text" name="model" class="form-control bg-light border-0" value="{{car.model}}"
                                required>
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">NƒÉm SX *</label>
                            <input type="number" name="year" class="form-control bg-light border-0" value="{{car.year}}"
                                min="2000" max="2030" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Bi·ªÉn s·ªë *</label>
                            <input type="text" name="plateNumber" class="form-control bg-light border-0"
                                value="{{car.plateNumber}}" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Gi√° thu√™/ng√†y (‚Ç´) *</label>
                            <input type="number" name="pricePerDay" class="form-control bg-light border-0"
                                value="{{car.pricePerDay}}" min="0" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Tr·∫°ng th√°i *</label>
                            <select name="status" class="form-select bg-light border-0" required>
                                <option value="AVAILABLE" {{#if (eq car.status 'AVAILABLE' )}}selected{{/if}}>‚úÖ S·∫µn s√†ng
                                </option>
                                <option value="RENTED" {{#if (eq car.status 'RENTED' )}}selected{{/if}}>üî¥ ƒêang thu√™
                                </option>
                                <option value="MAINTENANCE" {{#if (eq car.status 'MAINTENANCE' )}}selected{{/if}}>‚ö†Ô∏è B·∫£o
                                    tr√¨</option>
                            </select>
                        </div>
                    </div>

                    <hr class="my-4">

                    {{!-- SECTION 2: Specifications --}}
                    <h6 class="text-muted fw-bold text-uppercase mb-3"><i class="bi bi-gear me-2"></i>Th√¥ng s·ªë k·ªπ thu·∫≠t
                    </h6>

                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Lo·∫°i xe *</label>
                            <select name="category" class="form-select bg-light border-0" required>
                                <option value="">-- Ch·ªçn lo·∫°i --</option>
                                <option value="ECONOMY" {{#if (eq car.category 'ECONOMY' )}}selected{{/if}}>üöô Ti·∫øt ki·ªám
                                </option>
                                <option value="COMFORT" {{#if (eq car.category 'COMFORT' )}}selected{{/if}}>üöó Tho·∫£i m√°i
                                </option>
                                <option value="PREMIUM" {{#if (eq car.category 'PREMIUM' )}}selected{{/if}}>‚ú® Cao c·∫•p
                                </option>
                                <option value="SUV" {{#if (eq car.category 'SUV' )}}selected{{/if}}>üöô SUV</option>
                                <option value="VAN" {{#if (eq car.category 'VAN' )}}selected{{/if}}>üöê Van/MPV</option>
                                <option value="LUXURY" {{#if (eq car.category 'LUXURY' )}}selected{{/if}}>üíé Sang tr·ªçng
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">H·ªôp s·ªë *</label>
                            <select name="transmission" class="form-select bg-light border-0" required>
                                <option value="AUTOMATIC" {{#if (eq car.transmission 'AUTOMATIC' )}}selected{{/if}}>T·ª±
                                    ƒë·ªông</option>
                                <option value="MANUAL" {{#if (eq car.transmission 'MANUAL' )}}selected{{/if}}>S·ªë s√†n
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Nhi√™n li·ªáu *</label>
                            <select name="fuelType" class="form-select bg-light border-0" required>
                                <option value="PETROL" {{#if (eq car.fuelType 'PETROL' )}}selected{{/if}}>‚õΩ XƒÉng
                                </option>
                                <option value="DIESEL" {{#if (eq car.fuelType 'DIESEL' )}}selected{{/if}}>üõ¢Ô∏è D·∫ßu
                                </option>
                                <option value="ELECTRIC" {{#if (eq car.fuelType 'ELECTRIC' )}}selected{{/if}}>‚ö° ƒêi·ªán
                                </option>
                                <option value="HYBRID" {{#if (eq car.fuelType 'HYBRID' )}}selected{{/if}}>üîã Hybrid
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">S·ªë ch·ªó ng·ªìi *</label>
                            <select name="seats" class="form-select bg-light border-0" required>
                                <option value="2" {{#if (eq car.seats 2)}}selected{{/if}}>2 ch·ªó</option>
                                <option value="4" {{#if (eq car.seats 4)}}selected{{/if}}>4 ch·ªó</option>
                                <option value="5" {{#if (eq car.seats 5)}}selected{{/if}}>5 ch·ªó</option>
                                <option value="7" {{#if (eq car.seats 7)}}selected{{/if}}>7 ch·ªó</option>
                                <option value="9" {{#if (eq car.seats 9)}}selected{{/if}}>9 ch·ªó</option>
                                <option value="11" {{#if (eq car.seats 11)}}selected{{/if}}>11+ ch·ªó</option>
                            </select>
                        </div>
                    </div>

                    <hr class="my-4">

                    {{!-- SECTION 3: Features --}}
                    <h6 class="text-muted fw-bold text-uppercase mb-3"><i class="bi bi-stars me-2"></i>Ti·ªán nghi</h6>

                    <div class="row g-2 mb-4">
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="GPS"
                                    id="featureGPS" {{#if (includes car.features 'GPS' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureGPS">üìç GPS/ƒê·ªãnh v·ªã</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="AIR_CONDITIONING"
                                    id="featureAC" {{#if (includes car.features 'AIR_CONDITIONING' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureAC">‚ùÑÔ∏è ƒêi·ªÅu h√≤a</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="BLUETOOTH"
                                    id="featureBT" {{#if (includes car.features 'BLUETOOTH' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureBT">üì± Bluetooth</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="USB_CHARGER"
                                    id="featureUSB" {{#if (includes car.features 'USB_CHARGER' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureUSB">üîå USB Charger</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="BACKUP_CAMERA"
                                    id="featureCAM" {{#if (includes car.features 'BACKUP_CAMERA' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureCAM">üì∑ Camera l√πi</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="CRUISE_CONTROL"
                                    id="featureCC" {{#if (includes car.features 'CRUISE_CONTROL' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureCC">üöÄ Cruise Control</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="LEATHER_SEATS"
                                    id="featureLS" {{#if (includes car.features 'LEATHER_SEATS' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureLS">ü™ë Gh·∫ø da</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="features" value="SUNROOF"
                                    id="featureSR" {{#if (includes car.features 'SUNROOF' )}}checked{{/if}}>
                                <label class="form-check-label small" for="featureSR">‚òÄÔ∏è C·ª≠a s·ªï tr·ªùi</label>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    {{!-- SECTION 4: Location --}}
                    <h6 class="text-muted fw-bold text-uppercase mb-3"><i class="bi bi-geo-alt me-2"></i>V·ªã tr√≠</h6>

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">Th√†nh ph·ªë *</label>
                            <input type="text" name="location[city]" class="form-control bg-light border-0"
                                value="{{car.location.city}}" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">Qu·∫≠n/Huy·ªán</label>
                            <input type="text" name="location[district]" class="form-control bg-light border-0"
                                value="{{car.location.district}}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">ƒê·ªãa ch·ªâ c·ª• th·ªÉ</label>
                            <input type="text" name="location[address]" class="form-control bg-light border-0"
                                value="{{car.location.address}}">
                        </div>
                    </div>

                    <hr class="my-4">

                    {{!-- SECTION 5: Pricing & Policies --}}
                    <h6 class="text-muted fw-bold text-uppercase mb-3"><i class="bi bi-cash me-2"></i>Ch√≠nh s√°ch thu√™
                    </h6>

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">Gi·ªõi h·∫°n km/ng√†y</label>
                            <input type="number" name="mileageLimit" class="form-control bg-light border-0"
                                value="{{car.mileageLimit}}" min="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">Ph√≠ v∆∞·ª£t km (‚Ç´/km)</label>
                            <input type="number" name="extraMileageCharge" class="form-control bg-light border-0"
                                value="{{car.extraMileageCharge}}" min="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">Ti·ªÅn ƒë·∫∑t c·ªçc (‚Ç´)</label>
                            <input type="number" name="deposit" class="form-control bg-light border-0"
                                value="{{car.deposit}}" min="0">
                        </div>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" name="insuranceIncluded" id="insuranceIncluded"
                            {{#if car.insuranceIncluded}}checked{{/if}}>
                        <label class="form-check-label" for="insuranceIncluded">
                            <i class="bi bi-shield-check me-1 text-success"></i>Bao g·ªìm b·∫£o hi·ªÉm c∆° b·∫£n
                        </label>
                    </div>

                    <hr class="my-4">

                    {{!-- SECTION 6: Description & Images --}}
                    <h6 class="text-muted fw-bold text-uppercase mb-3"><i class="bi bi-image me-2"></i>M√¥ t·∫£ & H√¨nh ·∫£nh
                    </h6>

                    <div class="mb-4">
                        <label class="form-label small fw-bold text-secondary">M√¥ t·∫£ chi ti·∫øt</label>
                        <textarea name="description" class="form-control bg-light border-0"
                            rows="3">{{car.description}}</textarea>
                    </div>

                    <div class="mb-4">
                        <label class="form-label small fw-bold text-secondary">URL H√¨nh ·∫£nh</label>
                        <input type="url" name="images" class="form-control bg-light border-0"
                            value="{{car.images.[0]}}">
                        <div class="form-text"><i class="bi bi-info-circle me-1"></i>Nh·∫≠p URL h√¨nh ·∫£nh xe</div>
                    </div>

                    {{!-- Ratings display (read-only) --}}
                    {{#if car.averageRating}}
                    <div class="alert alert-light border mb-4">
                        <div class="d-flex align-items-center">
                            <span class="text-warning fs-5 me-2">‚≠ê {{car.averageRating}}</span>
                            <span class="text-muted">({{car.totalReviews}} ƒë√°nh gi√°)</span>
                        </div>
                    </div>
                    {{/if}}

                    <hr class="my-4">

                    <div class="d-flex justify-content-between align-items-center">
                        <a href="/cars" class="text-decoration-none text-secondary fw-medium">
                            <i class="bi bi-arrow-left me-1"></i> Quay l·∫°i
                        </a>
                        <button type="submit"
                            class="btn btn-warning btn-lg shadow-sm px-5 rounded-pill fw-bold text-white">
                            <i class="bi bi-check-lg me-2"></i>C·∫≠p nh·∫≠t
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>